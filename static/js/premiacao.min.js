(function (){
  function insertAlert(categoryId, message, alert) {
    var alertDiv = `<div class="alert ${alert}" role="alert">${message}</div>`;
    $(".indication[category-id=" + categoryId + "]").prepend(alertDiv);
  }

  function removeAlert(categoryId) {
    $(".indication[category-id=" + categoryId + "] .alert").remove();
  }

  $(".vote-btn").click(function() {
    var el = $(this);
    el.attr("disabled", true);
    var categoryId = el.attr("category-id");
    var response = $("#nomination-" + categoryId).val();

    removeAlert(categoryId);

    $.ajax({
      url: "/api/vote/",
      data: {response: response, category: categoryId},
      method: "POST",
      success: function(data) {
        insertAlert(categoryId, data.message, 'alert-success');
      },
      error: function(data) {
        var msg = data ? data.responseJSON.message : 'Desculpe, tente novamente mais tarde!';
        insertAlert(categoryId, msg, 'alert-danger');
      }
    }).done(function() {
      el.removeAttr("disabled");
    });
  });
})();